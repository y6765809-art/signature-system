<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×–×¨×™××” ×¤×œ×•×¡ - ×’×¨×¡×” ×¢×•×‘×“×ª!</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #1A1A1A 0%, #2C2C2C 50%, #1A1A1A 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #FFD700;
        }
        
        .logo {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .slogan { font-size: 16px; color: #666; font-style: italic; }
        
        .upload-zone {
            border: 3px dashed #FFD700;
            border-radius: 15px;
            padding: 60px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }
        
        .upload-zone:hover {
            background: #fffef0;
            border-color: #FFA500;
        }
        
        #pdfCanvas {
            max-width: 100%;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
            cursor: crosshair;
        }
        
        .field-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .field-btn {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            background: white;
        }
        
        .field-btn:hover { background: #f0f0f0; }
        .field-btn.active { background: #FFD700; border-color: #FFA500; }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Heebo', sans-serif;
            font-size: 14px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,215,0,0.4);
        }
        
        .hidden { display: none !important; }
        
        .field-list {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .field-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .success-box {
            background: #e8f5e9;
            border: 3px solid #4CAF50;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        
        .link-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">âœ¨ ×–×¨×™××” ×¤×œ×•×¡</div>
            <div class="slogan">×ª×Ÿ ×œ×›×¡×£ ×©×œ×š ×œ×–×¨×•×</div>
        </div>
        
        <!-- ×©×œ×‘ 1: ×”×¢×œ××ª PDF -->
        <div id="uploadSection">
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 60px;">ğŸ“¤</div>
                <h3>×’×¨×•×¨ PDF ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</h3>
                <p>×’×•×“×œ ××§×¡×™××œ×™: 10MB</p>
            </div>
            <input type="file" id="fileInput" accept="application/pdf" style="display:none">
        </div>
        
        <!-- ×©×œ×‘ 2: ×”×•×¡×¤×ª ×©×“×•×ª -->
        <div id="pdfSection" class="hidden">
            <h3>ğŸ“„ ×”××¡××š ×©×œ×š</h3>
            <canvas id="pdfCanvas"></canvas>
            
            <h3>âœï¸ ×‘×—×¨ ×¡×•×’ ×©×“×” ×•×œ×—×¥ ×¢×œ ×”××¡××š:</h3>
            <div class="field-buttons">
                <button class="field-btn" data-type="signature">âœï¸ ×—×ª×™××”</button>
                <button class="field-btn" data-type="name">ğŸ‘¤ ×©× ××œ×</button>
                <button class="field-btn" data-type="email">ğŸ“§ ××™×™×œ</button>
                <button class="field-btn" data-type="date">ğŸ“… ×ª××¨×™×š</button>
                <button class="field-btn" data-type="id">ğŸ†” ×ª.×–</button>
            </div>
            
            <div class="field-list">
                <strong>×©×“×•×ª ×©× ×•×¡×¤×•: <span id="fieldCount">0</span></strong>
                <div id="fieldsContainer"></div>
            </div>
            
            <h3>ğŸ“ ×¤×¨×˜×™ ×”× ××¢×Ÿ:</h3>
            <input type="text" id="docName" placeholder="×©× ×”××¡××š (×—×•×–×” ×¢×‘×•×“×”, ×”×¡×›× ×•×›×•')">
            <input type="text" id="recipientName" placeholder="×©× ×”× ××¢×Ÿ ×”××œ×">
            <input type="email" id="recipientEmail" placeholder="××™×™×œ (××•×¤×¦×™×•× ×œ×™)">
            <input type="tel" id="recipientPhone" placeholder="×˜×œ×¤×•×Ÿ (××•×¤×¦×™×•× ×œ×™)">
            
            <button class="btn-primary" onclick="createLink()">
                ğŸ”— ×¦×•×¨ ×§×™×©×•×¨ ×œ×—×ª×™××”
            </button>
        </div>
        
        <!-- ×©×œ×‘ 3: ×§×™×©×•×¨ ××•×›×Ÿ -->
        <div id="linkSection" class="hidden">
            <div class="success-box">
                <h2 style="color: #4CAF50; margin-bottom: 20px;">âœ… ×”×§×™×©×•×¨ × ×•×¦×¨ ×‘×”×¦×œ×—×”!</h2>
                <p style="margin-bottom: 15px;">×”×¢×ª×§ ××ª ×”×§×™×©×•×¨ ×•×©×œ×— ×œ× ××¢×Ÿ:</p>
                <div class="link-box" id="linkOutput"></div>
                <button class="btn-primary" onclick="copyLink()" style="width: auto; display: inline-block;">
                    ğŸ“‹ ×”×¢×ª×§ ×§×™×©×•×¨
                </button>
                <button class="btn-primary" onclick="sendWhatsApp()" style="width: auto; display: inline-block; background: #25D366;">
                    ğŸ“± ×©×œ×— ×‘-WhatsApp
                </button>
            </div>
        </div>
    </div>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let pdfImage = '';
        let selectedFieldType = null;
        let fields = [];
        let fieldCounter = 0;
        let docName = '';
        let recipientName = '';
        let recipientEmail = '';
        let recipientPhone = '';
        
        const fieldTypes = {
            signature: { name: '×—×ª×™××”', icon: 'âœï¸', color: '#FFD700' },
            name: { name: '×©× ××œ×', icon: 'ğŸ‘¤', color: '#4CAF50' },
            email: { name: '××™×™×œ', icon: 'ğŸ“§', color: '#FF9800' },
            date: { name: '×ª××¨×™×š', icon: 'ğŸ“…', color: '#2196F3' },
            id: { name: '×ª.×–', icon: 'ğŸ†”', color: '#9C27B0' }
        };
        
        // ×”×¢×œ××ª PDF
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                alert('âŒ ×”×§×•×‘×¥ ×’×“×•×œ ××“×™ (××§×¡×™××•× 10MB)');
                return;
            }
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 2.0 });
                
                const canvas = document.getElementById('pdfCanvas');
                const ctx = canvas.getContext('2d');
                
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                await page.render({ canvasContext: ctx, viewport: viewport }).promise;
                
                pdfImage = canvas.toDataURL('image/jpeg', 0.8);
                
                document.getElementById('uploadSection').classList.add('hidden');
                document.getElementById('pdfSection').classList.remove('hidden');
                
                console.log('âœ… PDF loaded, image size:', pdfImage.length);
            } catch (error) {
                alert('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª PDF: ' + error.message);
            }
        });
        
        // ×‘×—×™×¨×ª ×©×“×”
        document.querySelectorAll('.field-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.field-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedFieldType = btn.getAttribute('data-type');
                console.log('Selected field:', selectedFieldType);
            });
        });
        
        // ×”×•×¡×¤×ª ×©×“×”
        document.getElementById('pdfCanvas').addEventListener('click', (e) => {
            if (!selectedFieldType) {
                alert('âš ï¸ ×‘×—×¨ ×¡×•×’ ×©×“×” ×§×•×“×');
                return;
            }
            
            const canvas = document.getElementById('pdfCanvas');
            const rect = canvas.getBoundingClientRect();
            
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            
            const field = {
                id: ++fieldCounter,
                type: selectedFieldType,
                name: fieldTypes[selectedFieldType].name,
                icon: fieldTypes[selectedFieldType].icon,
                color: fieldTypes[selectedFieldType].color,
                x: x,
                y: y,
                width: 0.15,
                height: 0.04
            };
            
            fields.push(field);
            console.log('Field added:', field);
            updateFieldsList();
            drawFields();
        });
        
        function drawFields() {
            const canvas = document.getElementById('pdfCanvas');
            const ctx = canvas.getContext('2d');
            
            const img = new Image();
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                
                fields.forEach(field => {
                    const x = field.x * canvas.width;
                    const y = field.y * canvas.height;
                    const w = field.width * canvas.width;
                    const h = field.height * canvas.height;
                    
                    ctx.fillStyle = field.color + '33';
                    ctx.fillRect(x, y, w, h);
                    ctx.strokeStyle = field.color;
                    ctx.lineWidth = 3;
                    ctx.strokeRect(x, y, w, h);
                    
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 14px Heebo, Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(field.icon + ' ' + field.name, x + w/2, y + h/2);
                });
            };
            img.src = pdfImage;
        }
        
        function updateFieldsList() {
            document.getElementById('fieldCount').textContent = fields.length;
            const container = document.getElementById('fieldsContainer');
            container.innerHTML = fields.map(f => `
                <div class="field-item">
                    <span>${f.icon} ${f.name}</span>
                    <button onclick="deleteField(${f.id})" style="background: #f44336; color: white; padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer;">ğŸ—‘ï¸ ××—×§</button>
                </div>
            `).join('');
        }
        
        function deleteField(id) {
            fields = fields.filter(f => f.id !== id);
            updateFieldsList();
            drawFields();
        }
        
        function createLink() {
            docName = document.getElementById('docName').value.trim();
            recipientName = document.getElementById('recipientName').value.trim();
            recipientEmail = document.getElementById('recipientEmail').value.trim();
            recipientPhone = document.getElementById('recipientPhone').value.trim();
            
            if (!docName) {
                alert('âŒ ×”×–×Ÿ ×©× ××¡××š');
                return;
            }
            
            if (!recipientName) {
                alert('âŒ ×”×–×Ÿ ×©× × ××¢×Ÿ');
                return;
            }
            
            if (fields.length === 0) {
                alert('âŒ ×”×•×¡×£ ×œ×¤×—×•×ª ×©×“×” ××—×“');
                return;
            }
            
            const data = {
                docName,
                recipientName,
                recipientEmail,
                recipientPhone,
                pdfImage,
                fields
            };
            
            const encoded = btoa(encodeURIComponent(JSON.stringify(data)));
            const baseURL = window.location.href.split('/').slice(0, -1).join('/');
            const signLink = `${baseURL}/sign.html?data=${encoded}`;
            
            document.getElementById('linkOutput').textContent = signLink;
            document.getElementById('pdfSection').classList.add('hidden');
            document.getElementById('linkSection').classList.remove('hidden');
            
            console.log('âœ… Link created, data size:', encoded.length);
        }
        
        function copyLink() {
            const link = document.getElementById('linkOutput').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('âœ… ×”×§×™×©×•×¨ ×”×•×¢×ª×§!');
            });
        }
        
        function sendWhatsApp() {
            if (!recipientPhone) {
                alert('âŒ ×œ× ×”×–× ×ª ××¡×¤×¨ ×˜×œ×¤×•×Ÿ');
                return;
            }
            
            const link = document.getElementById('linkOutput').textContent;
            const message = `×©×œ×•× ${recipientName},\n\n×× × ×—×ª×•× ×¢×œ ×”××¡××š "${docName}":\n\n${link}`;
            const whatsappURL = `https://wa.me/${recipientPhone.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
        }
    </script>
</body>
</html>
